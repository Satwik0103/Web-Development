<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Catchy Fishes</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="stylesheet" href="/public/css/style.css">
    <script src="/public/js/index.js"></script>
    <style>
        #gamescreen{
            display:none;
        }
    </style>
</head>
<body>
   <section id="hero">
    <div class="container">
        <div id="initialscreen" class="h-100">
            <div class="text">
                <h1>CATCHY FISHES</h1>
            </div>
            <div class="aqua">
                <div class="bubble">
                    <img src="/public/Image/bub.png">
                    <img src="/public/Image/bub.png">
                    <img src="/public/Image/bub.png">
                    <img src="/public/Image/bub.png">
                    <img src="/public/Image/bub.png">
                    <img src="/public/Image/bub.png">
                </div>
            </div>
            <button id='btnCreate' class="my-button-1">New Game</button>
            <button id='btnJoin' class="my-button-2">Join Game</button>
            <input type = 'text'class="txtarea" id = 'txtGameId'>
            <div id  = 'divPlayers'></div>
        </div>
        <div id="gamescreen" class="h-100">
            <div class="text1">
                <h1>CATCHY FISHES</h1>
            </div>
            <div class="text2">
                <h2>SCORE CARD</h2>
            </div>
            <div class="aqua1">
                <div class="bubble">
                    <img src="/public/Image/bub.png">
                    <img src="/public/Image/bub.png">
                    <img src="/public/Image/bub.png">
                    <img src="/public/Image/bub.png">
                    <img src="/public/Image/bub.png">
                    <img src="/public/Image/bub.png">
                </div>
                <div class="block1">
                    <h1>Player1</h1>
                    <h1 id=Scores>0</h1>
                    <h3>Round1-</h3>
                    <h3>Round2-</h3>
                    <h3>Round3-</h3>
                    <h3>Round4-</h3>
                    <h3>Round5-</h3>
                    <h3>Round6-</h3>
                    <h3>Round7-</h3>
                    <h3>Round8-</h3>
                </div>
                <div class="block2">
                    <h1>Player2</h1>
                    <h1 id=Scores>0</h1>
                    <h3>Round1-</h3>
                    <h3>Round2-</h3>
                    <h3>Round3-</h3>
                    <h3>Round4-</h3>
                    <h3>Round5-</h3>
                    <h3>Round6-</h3>
                    <h3>Round7-</h3>
                    <h3>Round8-</h3>
                </div>
                <div class="block3">
                    <h1>Player3</h1>
                    <h1 id=Scores>0</h1>
                    <h3>Round1-</h3>
                    <h3>Round2-</h3>
                    <h3>Round3-</h3>
                    <h3>Round4-</h3>
                    <h3>Round5-</h3>
                    <h3>Round6-</h3>
                    <h3>Round7-</h3>
                    <h3>Round8-</h3>
                </div>
                <div class="block4">
                    <h1>Player4</h1>
                    <h1 id=Scores>0</h1>
                    <h3>Round1-</h3>
                    <h3>Round2-</h3>
                    <h3>Round3-</h3>
                    <h3>Round4-</h3>
                    <h3>Round5-</h3>
                    <h3>Round6-</h3>
                    <h3>Round7-</h3>
                    <h3>Round8-</h3>
                </div>
                <button id="Fish1" class="my-button-3">Catch 1 Fish </button>
                <button id="Fish2" class="my-button-4" >Catch 2 Fish</button>
            </div>
        </div>
    </div>  
    <script>
        //HTML elements
        let clientId = null;
        let gameId = null;
        //let playerColor = null;


        let ws = new WebSocket("ws://localhost:3000")
        
        const gamescreen=document.getElementById('gamescreen');
        const initialscreen=document.getElementById('initialscreen');
        const btnCreate = document.getElementById("btnCreate");
        const btnJoin = document.getElementById("btnJoin");
        const txtGameId = document.getElementById("txtGameId");
        const divPlayers = document.getElementById("divPlayers");
        const fish1=document.getElementById("Fish1");
        const fish2=document.getElementById("Fish2");
       // const divBoard = document.getElementById("divBoard");
        //wiring events
        btnCreate.addEventListener("click", e => {
            const payLoad = {
            "method": "create",
            "clientId": clientId
            }

            ws.send(JSON.stringify(payLoad));

        })
        btnJoin.addEventListener("click", e => {

            if (gameId === null)
                gameId = txtGameId.value;
            
            const payLoad = {
                "method": "join",
                "clientId": clientId,
                "gameId": gameId
            }

            ws.send(JSON.stringify(payLoad));

        })

       

        ws.onmessage = message => {
            //message.data
            const response = JSON.parse(message.data);
            console.log(response);
            //connect
            
            if (response.method === "connect"){
                clientId = response.clientId;
                console.log("Client id Set successfully " + clientId)
            }

            //create
            if (response.method === "create"){
                gameId = response.game.id;
                console.log("game successfully created with id " + response.game.id )  
            }


            //update
            if (response.method === "update"){
                //{1: "red", 1}
                const fscore=response.fscore;
                const hscore=response.score;
            }/*
                if (!response.game.state) return;
                for(const b of Object.keys(response.game.state))
                {
                    const color = response.game.state[b];
                    const ballObject = document.getElementById("ball" + b);
                    ballObject.style.backgroundColor = color
                }

            }*/
            //join
            if (response.method === "join"){
                const game = response.game;

                while(divPlayers.firstChild)
                    divPlayers.removeChild (divPlayers.firstChild)
                var a=0;
                game.clients.forEach (c => {
                    a=a+1;
                    const d = document.createElement("div");
                    d.style.width = "200px";
                    d.style.background = c.color
                   // d.textContent = c.clientId;
                    d.textContent="Player Ready";
                    divPlayers.appendChild(d);

                    if (c.clientId === clientId) playerColor = c.color;
                    if(a==4){
                        initialscreen.style.display="none";
                        gamescreen.style.display='block';
                        init();
                    }
                })
                function init(){
                    //wiring events
                    Fish1.addEventListener("click", e => {
                        
                        const payLoad = {
                                "method": "play",
                                "clientId": clientId,
                                "gameId": gameId,
                                "FishNo": 1,
                                "FishiNo":0,
                                "color": playerColor
                        }
                        ws.send(JSON.stringify(payLoad))
                    })
                    Fish2.addEventListener("click",e=>{
                       
                            const payLoad = {
                                "method": "play",
                                "clientId": clientId,
                                "gameId": gameId,
                                "FishNo": 0,
                                "FishiNo":1,
                                "color": playerColor
                            }
                            ws.send(JSON.stringify(payLoad))
                        })
                }
                
            }
        }
    </script>
</body>
</html>
